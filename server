/**
 * LeanEngine 启动文件
 * 负责启动 HTTP 服务器和加载云函数
 */

const AV = require('leanengine');

// 加载云函数
require('./index');

// 初始化 LeanEngine
AV.init({
  appId: process.env.LEANCLOUD_APP_ID,
  appKey: process.env.LEANCLOUD_APP_KEY,
  masterKey: process.env.LEANCLOUD_APP_MASTER_KEY
});

// 如果不是在 LeanEngine 环境中，则需要手动启动 Express 服务器
if (process.env.LEANCLOUD_APP_ENV !== 'production') {
  const express = require('express');
  const app = express();
  
  // 使用 LeanEngine 中间件
  app.use(AV.express());
  
  const PORT = process.env.LEANCLOUD_APP_PORT || process.env.PORT || 3000;
  app.listen(PORT, function () {
    console.log('LeanEngine 本地开发服务器运行在端口:', PORT);
  });
}
